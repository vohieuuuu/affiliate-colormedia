ğŸ¯ Má»¥c tiÃªu há»‡ thá»‘ng
NgÆ°á»i dÃ¹ng sau khi Ä‘Äƒng nháº­p cÃ³ thá»ƒ tá»± chá»n vai trÃ² muá»‘n truy cáº­p: Affiliate Normal hoáº·c KOL/VIP.

Há»‡ thá»‘ng chá»‰ cho phÃ©p ngÆ°á»i dÃ¹ng truy cáº­p dashboard phÃ¹ há»£p vá»›i role Ä‘Æ°á»£c phÃ¢n.

NgÄƒn cháº·n truy cáº­p trÃ¡i phÃ©p (cáº£ frontend vÃ  backend).

TÃ¡ch biá»‡t hoÃ n toÃ n dá»¯ liá»‡u giá»¯a 2 role.

ğŸ—‚ï¸ PhÃ¢n loáº¡i vai trÃ² ngÆ°á»i dÃ¹ng

Role (PhÃ¢n quyá»n)	Dashboard truy cáº­p Ä‘Æ°á»£c	Dá»¯ liá»‡u Ä‘Æ°á»£c phÃ©p xem
normal	/dashboard	Chá»‰ dá»¯ liá»‡u liÃªn quan Ä‘áº¿n affiliate thÆ°á»ng
kol	/kol-dashboard	Chá»‰ dá»¯ liá»‡u liÃªn quan Ä‘áº¿n KOL/VIP
ğŸ” Chi tiáº¿t Requirement chá»©c nÄƒng
1. Quy trÃ¬nh Ä‘Äƒng nháº­p & chá»n vai trÃ²
a. Khi Ä‘Äƒng nháº­p thÃ nh cÃ´ng:
Backend tráº£ vá» thÃ´ng tin user (JWT, user info trong payload hoáº·c response):

userId

email

role: "normal" hoáº·c "kol"

b. Sau Ä‘Äƒng nháº­p:
Redirect Ä‘áº¿n má»™t trang chá»n vai trÃ²: /select-mode

Hiá»ƒn thá»‹ UI:
ğŸ‘‰ Báº¡n muá»‘n vÃ o dashboard nÃ o?

[Affiliate thÆ°á»ng]

[Affiliate KOL/VIP]

c. Kiá»ƒm tra trÆ°á»›c khi cho vÃ o:
Náº¿u role !== modeSelected â†’ thÃ´ng bÃ¡o lá»—i:
âŒ "Báº¡n khÃ´ng cÃ³ quyá»n truy cáº­p cháº¿ Ä‘á»™ nÃ y"

Náº¿u há»£p lá»‡ â†’ redirect Ä‘áº¿n dashboard tÆ°Æ¡ng á»©ng:

Normal: /dashboard

KOL/VIP: /kol-dashboard

2. Báº£o vá»‡ route trÃªn frontend
a. Má»—i dashboard cáº§n wrapper Ä‘á»ƒ kiá»ƒm tra:
auth.user.role === selectedMode

Náº¿u khÃ´ng há»£p lá»‡ â†’ redirect vá» /unauthorized

b. Wrapper example (giáº£ láº­p):
tsx
Copy
Edit
if (auth.user.role !== selectedMode) {
  return <Redirect to="/unauthorized" />
}
3. NgÄƒn truy cáº­p thá»§ cÃ´ng báº±ng URL
a. VÃ­ dá»¥:
User role normal cá»‘ truy cáº­p /kol-dashboard â†’ bá»‹ cháº·n.

Xá»­ lÃ½ trong ProtectedRoute hoáº·c ngay trong tá»«ng dashboard.

b. Trang /unauthorized:
Ná»™i dung:
âŒ "Báº¡n khÃ´ng cÃ³ quyá»n truy cáº­p vÃ o trang nÃ y"

CÃ³ nÃºt trá»Ÿ vá» /select-mode

4. Báº£o máº­t á»Ÿ Backend
a. Má»—i API cáº§n kiá»ƒm tra role trÆ°á»›c khi tráº£ dá»¯ liá»‡u.
VÃ­ dá»¥:

ts
Copy
Edit
// ExpressJS middleware giáº£ láº­p
if (user.role !== 'kol') {
  return res.status(403).json({ message: "Forbidden" });
}
b. Dá»¯ liá»‡u truy váº¥n tá»« DB cÅ©ng cáº§n phÃ¢n theo role, vÃ­ dá»¥:
sql
Copy
Edit
SELECT * FROM affiliate_data WHERE type = 'normal' AND user_id = ?
5. LÆ°u tráº¡ng thÃ¡i lá»±a chá»n mode
a. LÆ°u vÃ o:
Context (AuthContext)

Hoáº·c LocalStorage/SessionStorage: selectedMode

b. Khi user logout:
XoÃ¡ cáº£ auth + selectedMode

6. User tráº£i nghiá»‡m rÃµ rÃ ng vÃ  báº£o máº­t

TÃ¬nh huá»‘ng	Pháº£n há»“i há»‡ thá»‘ng
ÄÄƒng nháº­p thÃ nh cÃ´ng â†’ hiá»ƒn thá»‹ chá»n cháº¿ Ä‘á»™	OK, redirect Ä‘áº¿n /select-mode
Chá»n sai mode (khÃ¡c role)	ThÃ´ng bÃ¡o lá»—i, khÃ´ng redirect
GÃµ thá»§ cÃ´ng URL khÃ´ng thuá»™c quyá»n	Chuyá»ƒn Ä‘áº¿n /unauthorized
Gá»i API khÃ´ng Ä‘Ãºng quyá»n	Backend tráº£ 403 Forbidden
Truy cáº­p Ä‘Ãºng mode + role	Cho phÃ©p vÃ o, hiá»ƒn thá»‹ Ä‘Ãºng dashboard vÃ  dá»¯ liá»‡u
ğŸ› ï¸ Ká»¹ thuáº­t Ä‘á» xuáº¥t
âœ… Táº¡o AuthContext hoáº·c useAuth hook Ä‘á»ƒ chá»©a user + selectedMode.

âœ… Wrapper ProtectedRoute Ä‘á»ƒ check cáº£ 2 Ä‘iá»u kiá»‡n:

ÄÃ£ Ä‘Äƒng nháº­p

Role phÃ¹ há»£p vá»›i mode Ä‘Ã£ chá»n

âœ… Middleware backend kiá»ƒm tra JWT + role cho má»—i endpoint.

âœ… Route /select-mode vÃ  /unauthorized Ä‘Æ¡n giáº£n, dá»… xá»­ lÃ½ UX.

Náº¿u báº¡n cáº§n mÃ¬nh há»— trá»£ viáº¿t cÃ¡c Ä‘oáº¡n code máº«u nhÆ°:

ProtectedRoute nÃ¢ng cao

Middleware backend check role

Trang chá»n mode (/select-mode)

Context quáº£n lÃ½ auth + mode